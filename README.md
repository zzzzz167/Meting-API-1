# Meting-API

https://m.boochinoob.shop/test

## å†™åœ¨å‰é¢

Metingåç«¯çš„apiç»“æ„è¾ƒä¸ºå¤æ‚ï¼ŒåŸºç¡€æ˜¯ä¸€ä¸ª[æ¥å£](https://github.com/metowolf/Meting/blob/master/src/Meting.php)ï¼ŒåŸä½œè€…åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ äº†[phpåç«¯](https://github.com/metowolf/Meting-API/blob/master/api/root/var/www/meting/public/index.php)ï¼Œåˆç”¨nodeåšäº†ä¸€å±‚[wrapper](https://github.com/metowolf/Meting-API/tree/master/server)ã€‚

åŒæ—¶å¯ä»¥å‘ç°åŸä½œè€…åœ¨docker hubä¸Šä¼ äº†phpåç«¯çš„[é•œåƒ](https://hub.docker.com/r/metowolf/meting)ï¼Œä½†æ²¡æœ‰nodeçš„é•œåƒï¼ˆä»“åº“ä¸­ä»æœ‰Dockerfileï¼‰ã€‚

åŸä½œè€…å¤§ä½¬çš„apiæœåŠ¡å¯èƒ½ä¸å¤ªç¨³å®šï¼Œäºæ˜¯æˆ‘åœ¨ä¸Šé¢ä¸¤ä¸ªDockerfileçš„åŸºç¡€ä¸Šæ–°ç”Ÿæˆäº†å•ä¸€çš„Dockerfileï¼Œä»…ä»…å¯¹å¤–æš´éœ²ä¸€ä¸ª3000ç«¯å£ã€‚å¹¶ä¸”å¾®æ”¹äº†ä¸€äº›ä»£ç ï¼Œé€‚é…äº†vercelçš„serverless functionã€‚è¿™ä¸ªç‰ˆæœ¬åœ¨[v1](https://github.com/xizeyoupan/Meting-API/tree/v1)ã€‚

æ­¤ç‰ˆæœ¬è§£å†³äº†ä¸€äº›çš„é—®é¢˜ï¼Œä½†å¯èƒ½è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼š

- ä¾æ—§ä¸æ˜“è‡ªè¡Œéƒ¨ç½²
- å¯¹å›½å†…çš„äº‘å‡½æ•°ä¸å¤ªé€‚é…
- æ–°çš„éŸ³ä¹æºæ‰©å±•ã€ç»´æŠ¤å›°éš¾
- å³ä½¿åœ¨å›½å†…è®¿é—®ï¼Œå¦‚æœåç«¯éƒ¨ç½²åœ¨å›½å¤–ï¼Œè…¾è®¯ç³»éŸ³ä¹ä»ç„¶æ— æ³•è§£æ

ä¸ºæ­¤ï¼Œæˆ‘å¼€äº†ä¸ªæ–°çš„åˆ†æ”¯ã€‚

## Feature

- çº¯jså®ç°ï¼ŒåŒ–ç®€apiç»“æ„
- é€‚é…å¤šä¸ªPaaSå¹³å°ï¼Œä¸€é”®éƒ¨ç½²
- é‡‡ç”¨jsonpè§£å†³Tencentç³»åœ°åŒºé™åˆ¶
- æ’ä»¶ç³»ç»Ÿï¼Œç¼–å†™æ–°æ¥å£åŠéŸ³æºç®€å•

## apiç½‘å€

https://m.boochinoob.shop/api => cloudflare

https://meting-ve.2333332.xyz/api => vercel

https://meting-dd.2333332.xyz/api => Deno Deploy

å¯è‡ªè¡Œæµ‹è¯•ï¼Œå¦‚ https://m.boochinoob.shop/test

## è¿›åº¦

**ä»å›½å†…è®¿é—®**

|        | å•æ›²/song | æ­Œå•/playlist | åœ°åŒºé™åˆ¶ |
| ------ | --------- | ------------- | -------- |
| ç½‘æ˜“äº‘ | âˆš         | âˆš             | æ—        |
| qqéŸ³ä¹ | âˆš         | âˆš             | æ— *      |
| more   |           |               |          |

\*ä½¿ç”¨jsonpï¼Œ**éœ€è¦æ›¿æ¢å‰ç«¯æ’ä»¶**ï¼Œ https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js => https://cdn.jsdelivr.net/npm/@xizeyoupan/meting@latest/dist/Meting.min.js , or 
https://unpkg.com/meting@2.0.1/dist/Meting.min.js => https://unpkg.com/@xizeyoupan/meting@latest/dist/Meting.min.js

More info https://github.com/xizeyoupan/MetingJS

## éƒ¨ç½²

éƒ¨ç½² Meting-API éœ€è¦åŸºæœ¬çš„è®¡ç®—æœºç¼–ç¨‹å¸¸è¯†ï¼Œå¦‚æœæ‚¨åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜è¯·åˆ° issues å‘æˆ‘ä»¬æé—®ï¼Œæˆ‘ä»¬ä¼šå°½å¿«ç»™æ‚¨ç­”å¤ã€‚

å¦‚æœéƒ¨ç½²æˆåŠŸï¼Œåœ¨ä½ çš„åŸŸååæ‹¼æ¥ä¸Š`/test`ï¼Œç†è®ºä¸Šå‡ºç°ç±»ä¼¼ä¸‹å›¾æ•°æ®ï¼š

![](assets/test.png)

### æ‰‹åŠ¨éƒ¨ç½²

éœ€è¦å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼Œnodeç‰ˆæœ¬>=18ã€‚

```
npm i
npm run build:all
```

#### Node

`node node.js`

#### Deno

`deno run --allow-net --allow-env dist/deno.js`

æˆ–è€…ç›´æ¥ä¸‹è½½actionä¸­çš„æ–‡ä»¶è¿è¡Œã€‚

### Dockeréƒ¨ç½²

è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä¸‹è½½ Meting-API é•œåƒ

```
docker pull intemd/meting-api:latest
```

ç„¶åè¿è¡Œ Meting-API å³å¯

```
docker run -d --name meting -p 3000:3000 intemd/meting-api:latest
```

### éƒ¨ç½²åˆ°vercel

æ¯”è¾ƒå‡ºåï¼Œæä¾›çš„åŸŸåè¢«é˜»æ–­ï¼Œä½¿ç”¨è‡ªæœ‰åŸŸååé€Ÿåº¦å°šå¯ã€‚å†·å¯åŠ¨é€Ÿåº¦ä¸€èˆ¬ã€‚

<a href="https://vercel.com/import/project?template=https://github.com/xizeyoupan/Meting-API"><img src="https://vercel.com/button" height="36"></a>

ä¸€ç›´ä¸‹ä¸€æ­¥å³å¯ã€‚

### Cloudflare Workers

åœ¨å…¨çƒæ‹¥æœ‰æ•°æ®ä¸­å¿ƒï¼Œæä¾›çš„åŸŸåè¢«é˜»æ–­ï¼Œä½¿ç”¨è‡ªæœ‰åŸŸååé€Ÿåº¦å¾ˆå¿«ã€‚å†·å¯åŠ¨é€Ÿåº¦å¾ˆå¿«ã€‚

forkæœ¬é¡¹ç›®ï¼Œä¾æ¬¡ç‚¹å‡»actions/publish/run workflowã€‚ä¿æŒé»˜è®¤å³å¯ã€‚å¾…CIæ„å»ºç»“æŸåä¸‹è½½cloudflare-workers.jså¹¶è§£å‹ã€‚åœ¨[Workers](https://dash.cloudflare.com)åˆ›å»ºä¸€ä¸ªServiceï¼Œç‚¹å³ä¸Šè§’Quick editã€‚æŠŠcloudflare-workers.jsçš„å†…å®¹å¤åˆ¶è¿›å»deployå³å¯ã€‚

### Deno Deploy

ç±»ä¼¼Cloudflare Workersï¼Œä½†æä¾›çš„åŸŸåæœªè¢«é˜»æ–­ï¼Œä½¿ç”¨Denoä¸ºruntimeã€‚

forkæœ¬é¡¹ç›®åæ–°å»ºä¸€ä¸ª[project](https://dash.deno.com/projects)ï¼Œé¦–å…ˆåœ¨è®¾ç½®ä¸­åŠ ä¸€ä¸ªEnvironment Variableï¼Œåç§°æ˜¯OVERSEASï¼Œå€¼ä¸º1ã€‚æ¥ç€linkåˆ°ä½ è‡ªå·±çš„é¡¹ç›®ï¼Œéƒ¨ç½²æ–¹å¼é€‰actionï¼Œprojectçš„nameéœ€è¦ä¸ä½ è‡ªå·±çš„ymlå»åˆã€‚

```yml
        uses: denoland/deployctl@v1
        with:
          project: meting #è¿™é‡Œè¦æ”¹æˆä½ çš„projectçš„name
          entrypoint: deno.js
```

æ¥ç€åœ¨actions/publish/run workflowä¸­å‹¾é€‰Denoå³å¯ã€‚

<details><summary>éƒ¨ç½²åˆ°å›½å†…å¹³å°</summary>

ç›®å‰å›½å†…äº‘æœåŠ¡å•†å‘ˆç°ä¸¤è¶…å¤šå¼ºçš„æ€åŠ¿ã€‚æœ¬äººåˆ°å®˜æ–¹æ–‡æ¡£ç¿»æ¥ç¿»å»ï¼Œå‘ç°å„å‚å•†å…è´¹çš„äº‘å‡½æ•°æœåŠ¡æ˜¯è¶Šæ¥è¶Šå°‘äº†ï¼Œè…¾è®¯äº‘å…è´¹é¢åº¦å°±[ä¸‰ä¸ªæœˆ](https://cloud.tencent.com/document/product/583/12282)ï¼Œé˜¿é‡Œäº‘ä¼¼ä¹æœ‰[ä¸€å¹´](https://help.aliyun.com/document_detail/54301.html)ã€‚

#### åä¸ºäº‘

> ä¸æ˜¯åä¸ºæˆ‘ä¸ç”¨ã€‚å› ä¸ºä»–æ˜¯æœ‰è‰¯å¿ƒçš„ï¼Œä¸­å›½åˆ¶é€ ğŸ«¡

ç›®å‰åä¸ºäº‘æ¯ä¸ªæœˆæä¾›ä¸€å®šçš„[å…è´¹é¢åº¦](https://support.huaweicloud.com/productdesc-functiongraph/functiongraph_01_0190.html)ï¼ŒåŒ…æ‹¬[æ—¥å¿—](https://www.huaweicloud.com/pricing.html?tab=detail#/aom)ã€‚

> çˆ†ï¼çˆ†ï¼çˆ†ï¼è¿™ä¸‹çœŸçš„çˆ†äº†ï¼

ğŸ‘†æŒ‡çš„æ˜¯åä¸ºäº‘è™½ç„¶å‡½æ•°å·¥ä½œæµæœ‰å…è´¹é¢åº¦ï¼Œä½†é…å¥—çš„APIç½‘å…³å´ä¸å…è´¹ï¼Œè¿™ä¸åˆšè°ƒè¯•å®Œæ²¡å¤šä¹…å°±å‘ç°æ¬ è´¹1åˆ†é’±ï¼Œæ— å¥ˆè¢«è¿«å……å€¼äº†**1å…ƒ**ã€‚ç†è®ºä¸Š1å…ƒåº”è¯¥èƒ½ç”¨æŒºä¹…çš„ã€‚å½“ç„¶ä½ å¦‚æœæ²¡æœ‰1å…ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å……1æ¯›è¯•è¯•æ°´ã€‚

1. æ³¨å†Œå¹¶è®¤è¯
   - ä¸­å›½ç«™éœ€è¦æ‰‹æœºéªŒè¯ç +å®åè®¤è¯ã€‚
   - å¤–å›½ç«™éœ€è¦æ‰‹æœºéªŒè¯ç +å¯ç”¨çš„Visa/MasterCard/*ä¿¡ç”¨å¡ã€‚

2. ä¸‹è½½é•œåƒ

   - åœ¨githubä¸ŠForkæœ¬é¡¹ç›®ã€‚
   - ä¾æ¬¡ç‚¹å‡»actions/workflow/run workflowã€‚ ![](assets/1.png)
   - ç­‰å¾…CIå®Œæˆåç‚¹è¿›ç¬¬ä¸€ä¸ªworkflowä¸‹è½½artifactã€‚ ![](assets/2.png)
   - ä»ä¸‹è½½çš„æ–‡ä»¶ä¸­è§£å‹å‡ºmeting.tar.gzã€‚

3. ä¸Šä¼ é•œåƒ

   - ç™»å½•[é•œåƒæœåŠ¡](https://console.huaweicloud.com/swr)ï¼Œé€‰æ‹©é¡µé¢ä¸Šä¼ ï¼Œåˆ›å»ºä¸€ä¸ªåå­—éšæ„çš„ç»„ç»‡ï¼Œä¸Šä¼ é•œåƒã€‚
   - ç‚¹å‡»meting-apiï¼Œæ‰¾åˆ°ä¸‹è½½æŒ‡ä»¤ï¼Œå¤åˆ¶ docker pull åé¢çš„é•œåƒåœ°å€ã€‚

4. åˆ›å»ºå‡½æ•°

   - åœ¨[å‡½æ•°æœåŠ¡](https://console.huaweicloud.com/functiongraph)ç‚¹å‡»åˆ›å»ºå‡½æ•°ã€‚æ³¨æ„ç±»å‹é€‰**HTTP**ã€‚ ![](assets/3.png) 
   - åŒºåŸŸé€‰å›½å†…çš„ï¼Œå¹¶ä¸”åç»­æœåŠ¡ä¹Ÿå»ºè®®å¼€åœ¨ç›¸åŒåŒºåŸŸã€‚
   - é•œåƒå¡«åˆšåˆšå¤åˆ¶çš„åœ°å€ã€‚

5. åˆ›å»ºå§”æ‰˜

   - åç§°éšä¾¿ã€‚
   - ç±»å‹é€‰äº‘æœåŠ¡ã€‚
   - äº‘æœåŠ¡é€‰æ‹©"å‡½æ•°å·¥ä½œæµ FunctionGraph"ã€‚
   - ä¸‹ä¸€æ­¥ç­–ç•¥å‹¾é€‰"SWR Admin"å³å¯ã€‚
   - ä¸€è·¯å®Œæˆï¼Œè¿”å›åˆ›å»ºå‡½æ•°é¡µé¢é€‰æ‹©åˆšåˆ›å»ºçš„å§”æ‰˜ï¼Œåˆ›å»ºå‡½æ•°ã€‚

6. è®¾ç½®å‡½æ•°

   - å»ºè®®éœ€è¦è°ƒæ•´çš„è®¾ç½®å¦‚ä¸‹ï¼š ![](assets/4.png) ![](assets/5.png)
   - åˆ›å»ºè§¦å‘å™¨ï¼Œå…¶ä¸­åˆ†ç»„æŒ‰æç¤ºåˆ›å»ºå³å¯ã€‚ ![](assets/6.png)

7. è®¾ç½®ç½‘å…³

   - ç‚¹å‡»åˆšåˆ›å»ºçš„APIGè§¦å‘å™¨ï¼Œå³ä¸Šè§’ç¼–è¾‘ï¼Œè¿™é‡Œé™¤äº†æ”¹è¯·æ±‚pathï¼Œå…¶ä»–éƒ½ä¸‹ä¸€æ­¥ã€‚ ![](assets/7.png)
   - æ¥ç€å‘å¸ƒAPIã€‚åœ¨APIè¯¦æƒ…ç•Œé¢å¯ä»¥çœ‹åˆ°ä½ çš„API URLã€‚åœ¨å…¶ååŠ ä¸Š/apiè®¿é—®ï¼Œèƒ½çœ‹åˆ°æ•°æ®å°±è¯´æ˜æˆåŠŸäº†ã€‚


8. å®Œæˆ

   æ€»ç»“ä¸€ä¸‹ï¼šåä¸ºäº‘çš„è¿™ä¸ªæœåŠ¡ç¡®å®åˆè‡­åˆé•¿ï¼Œå¯¹äºå¤§å…¬å¸å¯èƒ½å«ç”Ÿæ€ä¸°å¯Œï¼Œä½“ç³»å¥å…¨ï¼Œä½†å¯¹æƒ³å¿«é€Ÿä¸Šæ‰‹çš„åŒå­¦ç¡®å®ä¸å¤ªå‹å¥½ã€‚å„æœåŠ¡ä¹‹é—´çš„æ–‡æ¡£åˆ†å¸ƒæ¾æ•£ï¼Œéš¾ä»¥è·³è½¬ã€‚åœ¨æˆ‘å†™è¿™æ®µè¯çš„æ—¶å€™è¿˜çªç„¶æŠ½é£äº†å‡ å°æ—¶ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¨æ™šèƒ½è·‘çš„ä»£ç æ€ä¹ˆç¡ä¸€è§‰å°±ä¸å¥½ä½¿äº†ã€‚å½“ç„¶æŠŠMetingç”¨jsé‡å†™å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚

</details>

## æ‚é¡¹

### åå‘ä»£ç†

å¯¹äºå¾ˆå¤šHTTPæ¡†æ¶çš„ä»£ç†æ¥è¯´ï¼Œåªéœ€è®¾ç½®X-Forwardedè¯·æ±‚å¤´æˆ–transparent proxyã€‚ä½†ç”±äºæœ¬é¡¹ç›®ä½¿ç”¨äº†è½»é‡åŒ–æ¡†æ¶Honoï¼Œè¿›è¡Œåå‘ä»£ç†çš„æ—¶å€™å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›ä»¤äººä¸é€‚çš„é“¾æ¥ã€‚è¿™é‡Œæˆ‘ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚å¤´`X-Forwarded-Url`æ¥æš´åŠ›å¤„ç†originå’Œè·¯å¾„çš„å‰ç¼€ã€‚

æ¯”å¦‚æˆ‘ç”¨nginxæƒ³è®©è¯·æ±‚ `http://localhost:8099/meting` çš„æµé‡å…¨éƒ¨è½¬å‘åˆ° `http://localhost:3000` ï¼Œç›´æ¥è¿™ä¹ˆå†™æ˜¯ä¸è¡Œçš„ï¼š

```
   server {
      listen       8099;
      server_name  localhost;

      location /meting/ {
         proxy_pass http://localhost:3000/;
      }
   }
```

æ­£ç¡®å†™æ³•ï¼š

- nginx

   ```
   server {
      listen       8099;
      server_name  localhost;

      location /meting/ {
         proxy_pass http://localhost:3000/;
         proxy_set_header X-Forwarded-Url $scheme://$host:$server_port/meting;
      }
   }
   ```

- caddy
  
  ```
   http://localhost:8099 {
         handle_path /meting* {
                  reverse_proxy http://localhost:3000 {
                        header_up X-Forwarded-Url {scheme}://{host}:{port}/meting
                  }
         }
   }
  ```

### SSLè¯ä¹¦

åœ¨ä¸Šé¢åŸºç¡€ä¸Šæ”¹åŠ¨å³å¯ã€‚

- nginx
  ```
      server {
        listen       8099 ssl;
        server_name  localhost;

        ssl_certificate     ../server.crt;  # pemæ–‡ä»¶çš„è·¯å¾„
        ssl_certificate_key  ../server.key; # keyæ–‡ä»¶çš„è·¯å¾„
        ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers on;

        location /meting/ {
            proxy_pass http://localhost:3000/;
            proxy_set_header X-Forwarded-Url $scheme://$host:$server_port/meting;
        }
      }
  ```

- caddy
  ```
   https://localhost:8099 {
      tls ./server.crt ./server.key
      handle_path /meting* {
         reverse_proxy http://localhost:3000 {
            header_up X-Forwarded-Url {scheme}://{host}:{port}/meting
         }
      }
   }
  ```

## ä½¿ç”¨

åœ¨å¯¼å…¥[å‰ç«¯æ’ä»¶](https://github.com/xizeyoupan/MetingJS)å‰ï¼ŒåŠ å…¥

```
<script>
var meting_api='http://example.com/api?server=:server&type=:type&id=:id&auth=:auth&r=:r';
</script>
```

æ¯”å¦‚

```
<script>
var meting_api='http://localhost:3000/api?server=:server&type=:type&id=:id&auth=:auth&r=:r';
</script>
```

å³å¯ã€‚å°±è¿™æ ·å§ï¼Œé‚£æˆ‘å»çœ‹vtbäº†ï¼Œ88

### ç›¸å…³é¡¹ç›®

https://github.com/metowolf/MetingJS

https://github.com/metowolf/Meting-API

https://github.com/honojs/hono

https://github.com/honojs/node-server

https://github.com/camsong/fetch-jsonp
